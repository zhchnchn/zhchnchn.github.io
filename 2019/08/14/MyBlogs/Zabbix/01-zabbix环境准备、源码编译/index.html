<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="zabbix环境准备、源码编译环境准备关闭防火墙和SELinux1、关闭防火墙： 1234567# 关闭防火墙[root@localhost ~]# systemctl stop firewalld.service# 禁止防火墙开机自启[root@localhost ~]# systemctl disable firewalld.service# 查看防火墙状态[root@localhost ~]">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2019/08/14/MyBlogs/Zabbix/01-zabbix环境准备、源码编译/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="zabbix环境准备、源码编译环境准备关闭防火墙和SELinux1、关闭防火墙： 1234567# 关闭防火墙[root@localhost ~]# systemctl stop firewalld.service# 禁止防火墙开机自启[root@localhost ~]# systemctl disable firewalld.service# 查看防火墙状态[root@localhost ~]">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yoursite.com/2019/08/14/MyBlogs/Zabbix/01-zabbix环境准备、源码编译/zabbix%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg">
<meta property="og:updated_time" content="2019-08-14T10:42:55.336Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="zabbix环境准备、源码编译环境准备关闭防火墙和SELinux1、关闭防火墙： 1234567# 关闭防火墙[root@localhost ~]# systemctl stop firewalld.service# 禁止防火墙开机自启[root@localhost ~]# systemctl disable firewalld.service# 查看防火墙状态[root@localhost ~]">
<meta name="twitter:image" content="http://yoursite.com/2019/08/14/MyBlogs/Zabbix/01-zabbix环境准备、源码编译/zabbix%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-MyBlogs/Zabbix/01-zabbix环境准备、源码编译" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/14/MyBlogs/Zabbix/01-zabbix环境准备、源码编译/" class="article-date">
  <time datetime="2019-08-14T10:18:46.682Z" itemprop="datePublished">2019-08-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="zabbix环境准备、源码编译"><a href="#zabbix环境准备、源码编译" class="headerlink" title="zabbix环境准备、源码编译"></a>zabbix环境准备、源码编译</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="关闭防火墙和SELinux"><a href="#关闭防火墙和SELinux" class="headerlink" title="关闭防火墙和SELinux"></a>关闭防火墙和SELinux</h3><p>1、关闭防火墙：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 关闭防火墙</span><br><span class="line">[root@localhost ~]# systemctl stop firewalld.service</span><br><span class="line"># 禁止防火墙开机自启</span><br><span class="line">[root@localhost ~]# systemctl disable firewalld.service</span><br><span class="line"># 查看防火墙状态</span><br><span class="line">[root@localhost ~]# firewall-cmd --state</span><br><span class="line">not running</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p><img src="/2019/08/14/MyBlogs/Zabbix/01-zabbix环境准备、源码编译/zabbix%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg" alt></p>
<p>2、关闭SELinux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 禁用selinux，需重启生效</span><br><span class="line">[root@localhost ~]# sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/config  </span><br><span class="line"># 临时关闭selinux，下次重启会恢复</span><br><span class="line">[root@localhost ~]# setenforce 0</span><br></pre></td></tr></table></figure>

<h3 id="安装MySQL5-7"><a href="#安装MySQL5-7" class="headerlink" title="安装MySQL5.7"></a>安装MySQL5.7</h3><p>1、CentOS 7上把MySQL从默认软件列表中移除了，用MariaDB来代替。所以安装之前：（1）先删除MariaDB，（2）安装yum源.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查看是否有mariadb和Mysql</span><br><span class="line">[root@localhost ~]# rpm -qa | grep -i mariadb</span><br><span class="line">mariadb-libs-5.5.52-1.el7.x86_64</span><br><span class="line">[root@localhost ~]# rpm -qa | grep mysql</span><br><span class="line"># 删除mariadb</span><br><span class="line">[root@localhost ~]# rpm -e --nodeps mariadb-libs-5.5.52-1.el7.x86_64</span><br><span class="line"></span><br><span class="line"># 添加mysql源</span><br><span class="line">[root@localhost ~]# wget http://repo.mysql.com/mysql57-community-release-el7.rpm</span><br><span class="line">[root@localhost ~]# ls</span><br><span class="line">mysql57-community-release-el7.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh mysql57-community-release-el7.rpm</span><br></pre></td></tr></table></figure>

<p>2、安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install -y mysql-server mysql-devel mysql</span><br></pre></td></tr></table></figure>

<p>3、配置 mysql 字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/my.cnf，在文件末尾加上：character-set-server=utf8</span><br><span class="line"># encoding</span><br><span class="line">character-set-server=utf8</span><br></pre></td></tr></table></figure>

<p>4、启动 mysql 服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># service mysqld start</span><br></pre></td></tr></table></figure>

<p>NOTE：服务的启动、停止、查看状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl status mysqld.service   #查看mysql状态</span><br><span class="line">[root@localhost ~]# systemctl start mysqld.service    #启动mysql服务</span><br><span class="line">[root@localhost ~]# systemctl stop mysqld.service     #停止mysql服务</span><br><span class="line"># 或者</span><br><span class="line">[root@localhost ~]# service mysqld status</span><br><span class="line">[root@localhost ~]# service mysqld start</span><br><span class="line">[root@localhost ~]# service mysqld stop</span><br></pre></td></tr></table></figure>

<p>5、查询首次安装随机密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# grep &apos;temporary password&apos; /var/log/mysqld.log</span><br><span class="line">[Note] A temporary password is generated for root@localhost: Cg:&lt;uu#OK2q-</span><br></pre></td></tr></table></figure>

<p>6、登录数据库，输入上面查询的密码登陆</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p</span><br></pre></td></tr></table></figure>

<p>7、修改 root 密码</p>
<p>（1）首先，修改 mysql5.7 的默认密码策略：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 密码长度符合即可</span><br><span class="line">mysql&gt; set global validate_password_policy=0;</span><br><span class="line"># 修改密码默认长度为最小值，即4位</span><br><span class="line">mysql&gt; set global validate_password_length=4;</span><br></pre></td></tr></table></figure>

<p>（2）修改密码命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set password=password(&apos;123456&apos;);</span><br></pre></td></tr></table></figure>

<p>（3）退出，使用新密码登陆 mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p123456</span><br></pre></td></tr></table></figure>

<p>8、对root用户设置远程访问</p>
<p>（1）查询 mysql 库的 user 表的用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host, user from mysql.user;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| host      | user          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">| localhost | root          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>（2）创建远程访问用户’root’，密码为’123456’：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create user &apos;root&apos;@&apos;%&apos; identified by &apos;123456&apos;;</span><br><span class="line">mysql&gt; select host, user from mysql.user;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| host      | user          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| %         | root          |</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">| localhost | root          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>（3）授权：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all privileges on *.* to &apos;root&apos;@&apos;%&apos;;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>

<p>（4）在虚拟机外的主机上，使用数据库客户端连接软件（比如Navicat Premium），进行连接测试。</p>
<h2 id="安装Zabbix4-0"><a href="#安装Zabbix4-0" class="headerlink" title="安装Zabbix4.0"></a>安装Zabbix4.0</h2><p>NOTE：下面的命令都是对CentOS 7版本的操作系统的操作。<br>参考：<a href="https://www.zabbix.com/documentation/4.0/zh/manual/installation/install_from_packages/rhel_centos" target="_blank" rel="noopener">https://www.zabbix.com/documentation/4.0/zh/manual/installation/install_from_packages/rhel_centos</a></p>
<h3 id="添加源"><a href="#添加源" class="headerlink" title="添加源"></a>添加源</h3><p>1、添加 Zabbix 软件仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># rpm -ivh http://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br><span class="line"># 如果不能访问，可以使用阿里云的源</span><br><span class="line"># rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>2、前端安装的先决条件<br>Zabbix 前端需要额外的基础安装包。您需要在运行 Zabbix 前端的系统中启用可选 rpms 的软件仓库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum-config-manager --enable rhel-7-server-optional-rpms</span><br></pre></td></tr></table></figure>

<h3 id="安装Server-前端-agent"><a href="#安装Server-前端-agent" class="headerlink" title="安装Server/前端/agent"></a>安装Server/前端/agent</h3><p>1、安装 Zabbix server，Zabbix 前端（不安装Zabbix proxy），并使用 MySQL 数据库，：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y zabbix-server-mysql zabbix-web-mysql zabbix-agent</span><br><span class="line">错误：php72w-common conflicts with php70w-common-7.0.33-1.w7.x86_64</span><br><span class="line"> 您可以尝试添加 --skip-broken 选项来解决该问题</span><br><span class="line"> 您可以尝试执行：rpm -Va --nofiles --nodigest</span><br></pre></td></tr></table></figure>

<p>报以上错误，添加<code>--skip-broken</code>后重新执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent --skip-broken</span><br></pre></td></tr></table></figure>

<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>1、对于Zabbix server和proxy守护进程而言，数据库是必须的。如果 Zabbix server 和 Zabbix proxy 安装在相同的主机，它们必须创建不同名字的数据库！</p>
<p>2、创建<code>zabbix</code>数据库，<code>zabbix</code>用户（密码也为<code>zabbix</code>），并把<code>zabbix</code>数据库的权限赋给<code>zabbix</code>用户。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mysql -uroot -p123456</span><br><span class="line">mysql&gt; create database zabbix character set utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;zabbix&apos;;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; quit;</span><br></pre></td></tr></table></figure>

<h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><p>1、安装完zabbix server后，数据库脚本文件存放在<code>/usr/share/doc/zabbix-server-mysql-4.0.8/create.sql.gz</code>下。</p>
<p>2、该文件是<code>schema.sql</code>,<code>images.sql</code>,<code>data.sql</code>的合成文件。因此只导入该文件就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 以zabbix用户登录，并打开zabbix数据库，然后在zabbix数据库中执行数据库脚本</span><br><span class="line"># zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -pzabbix zabbix</span><br></pre></td></tr></table></figure>

<h3 id="为Zabbix-server配置数据库"><a href="#为Zabbix-server配置数据库" class="headerlink" title="为Zabbix server配置数据库"></a>为Zabbix server配置数据库</h3><p>1、编辑<code>zabbix_server.conf</code>文件以使用已创建的数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">DBHost=localhost</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br></pre></td></tr></table></figure>

<h3 id="启动Zabbix-server进程"><a href="#启动Zabbix-server进程" class="headerlink" title="启动Zabbix server进程"></a>启动Zabbix server进程</h3><p>1、运行以下命令以启动 Zabbix server 进程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># service zabbix-server start</span><br></pre></td></tr></table></figure>

<p>2、设置系统启动时让zabbix自启：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable zabbix-server</span><br></pre></td></tr></table></figure>

<h3 id="启动Apache服务器"><a href="#启动Apache服务器" class="headerlink" title="启动Apache服务器"></a>启动Apache服务器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># service httpd start</span><br></pre></td></tr></table></figure>

<h3 id="Zabbix前端配置"><a href="#Zabbix前端配置" class="headerlink" title="Zabbix前端配置"></a>Zabbix前端配置</h3><p>1、对于RHEL 7 和更高版本，Zabbix 前端的 Apache 配置文件位于<code>/etc/httpd/conf.d/zabbix.conf</code>。虽然已经配置了一些 PHP 参数。但是有必要取消 “date.timezone” 注释，并为其 设置正确的时区 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">...</span><br><span class="line">    &lt;IfModule mod_php5.c&gt;</span><br><span class="line">        php_value max_execution_time 300</span><br><span class="line">        php_value memory_limit 128M</span><br><span class="line">        php_value post_max_size 16M</span><br><span class="line">        php_value upload_max_filesize 2M</span><br><span class="line">        php_value max_input_time 300</span><br><span class="line">        php_value max_input_vars 10000</span><br><span class="line">        php_value always_populate_raw_post_data -1</span><br><span class="line">        # php_value date.timezone Europe/Riga</span><br><span class="line">    &lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>

<p>将<code># php_value date.timezone Europe/Riga</code>的注释打开，并修改为<code>php_value date.timezone Asia/Shanghai</code>。</p>
<p>2、安装前端。<br>参考图示：<a href="https://www.zabbix.com/documentation/4.0/zh/manual/installation/install#installing_frontend" target="_blank" rel="noopener">https://www.zabbix.com/documentation/4.0/zh/manual/installation/install#installing_frontend</a></p>
<ul>
<li>打开<code>http://127.0.0.1/zabbix</code>，可以看到前端安装向导的第一个页面</li>
<li>点Next step（先决条件检查，如果以上步骤都没有问题的话，这里状态全部都是OK）<ul>
<li>这里<code>/usr/share/zabbix/assets</code>目录不是可写的，修改其权限：<code>chmod -R 777 /usr/share/zabbix/assets</code></li>
</ul>
</li>
<li>点Next step（配置数据库连接）<ul>
<li>输入之前设置的数据库里zabbix用户的密码，其他保持默认，下一步</li>
</ul>
</li>
<li>点Next step（Zabbix server details，直接默认下一步）</li>
<li>点Next step（Pre-installation summary，安装前总结：直接下一步）</li>
<li>点Next step（安装完成页面）</li>
<li>点Finish</li>
<li>待前端配置完成后，需要重启Apache服务器: <code>service httpd restart</code></li>
<li>Zabbix前端已经就绪！默认的用户名是<code>Admin</code>，密码是<code>zabbix</code>。</li>
</ul>
<h3 id="启动Agent"><a href="#启动Agent" class="headerlink" title="启动Agent"></a>启动Agent</h3><p>1、运行以下命令以启动 Zabbix agent：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># service zabbix-agent start</span><br></pre></td></tr></table></figure>

<h2 id="编译Zabbix源码"><a href="#编译Zabbix源码" class="headerlink" title="编译Zabbix源码"></a>编译Zabbix源码</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>编译源码之前，首先要安装一些依赖库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y zlib zlib-devel libevent libevent-devel pcre pcre-devel</span><br></pre></td></tr></table></figure>

<h3 id="配置源码并编译"><a href="#配置源码并编译" class="headerlink" title="配置源码并编译"></a>配置源码并编译</h3><p>1、配置源代码</p>
<p>（1）如果要查看所有受支持的配置选项，请在解压缩的 Zabbix 源代码目录中运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ./configure --help</span><br></pre></td></tr></table></figure>

<p>（2）配置 Zabbix server 和 Zabbix agent 的源代码。一定要配置<code>--prefix</code>选项，以防止破坏yum安装的zabbix程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"># 创建ZbxServer/zabbix目录，用作zabbix的安装目录</span><br><span class="line"># mkdir -p /home/zhang/ZbxServer/zabbix</span><br><span class="line"># 配置 server，agent，使用mysql数据库</span><br><span class="line"># ./configure --prefix=/home/zhang/ZbxServer/zabbix --enable-server --enable-agent --with-mysql</span><br><span class="line">...</span><br><span class="line">Configuration:</span><br><span class="line"></span><br><span class="line">  Detected OS:           linux-gnu</span><br><span class="line">  Install path:          /home/zhang/ZbxServer/zabbix</span><br><span class="line">  Compilation arch:      linux</span><br><span class="line"></span><br><span class="line">  Compiler:              cc</span><br><span class="line">  Compiler flags:         -g -O2 </span><br><span class="line"></span><br><span class="line">  Library-specific flags:</span><br><span class="line">    database:               -I/usr/include/mysql -m64    </span><br><span class="line"></span><br><span class="line">  Enable server:         yes</span><br><span class="line">  Server details:</span><br><span class="line">    With database:         MySQL</span><br><span class="line">    WEB Monitoring:        no</span><br><span class="line">    Native Jabber:         no</span><br><span class="line">    SNMP:                  no</span><br><span class="line">    IPMI:                  no</span><br><span class="line">    SSH:                   no</span><br><span class="line">    TLS:                   no</span><br><span class="line">    ODBC:                  no</span><br><span class="line">    Linker flags:             -L/usr/lib64/mysql                -rdynamic   </span><br><span class="line">    Libraries:               -lmysqlclient  -lpthread -lm -lrt -ldl          -lz -lpthread -levent    -lm -ldl  -lresolv -lpcre </span><br><span class="line">    Configuration file:    /home/zhang/ZbxServer/zabbix/etc/zabbix_server.conf</span><br><span class="line">    External scripts:      /home/zhang/ZbxServer/zabbix/share/zabbix/externalscripts</span><br><span class="line">    Alert scripts:         /home/zhang/ZbxServer/zabbix/share/zabbix/alertscripts</span><br><span class="line">    Modules:               /home/zhang/ZbxServer/zabbix/lib/modules</span><br><span class="line"></span><br><span class="line">  Enable proxy:          no</span><br><span class="line"></span><br><span class="line">  Enable agent:          yes</span><br><span class="line">  Agent details:</span><br><span class="line">    TLS:                   no</span><br><span class="line">    Linker flags:                -rdynamic   </span><br><span class="line">    Libraries:              -lz -lpthread    -lm -ldl  -lresolv -lpcre </span><br><span class="line">    Configuration file:    /home/zhang/ZbxServer/zabbix/etc/zabbix_agentd.conf</span><br><span class="line">    Modules:               /home/zhang/ZbxServer/zabbix/lib/modules</span><br><span class="line"></span><br><span class="line">  Enable Java gateway:   no</span><br><span class="line"></span><br><span class="line">  LDAP support:          no</span><br><span class="line">  IPv6 support:          no</span><br><span class="line"></span><br><span class="line">***********************************************************</span><br><span class="line">*            Now run &apos;make install&apos;                       *</span><br><span class="line">*                                                         *</span><br><span class="line">*            Thank you for using Zabbix!                  *</span><br><span class="line">*              &lt;http://www.zabbix.com&gt;                    *</span><br><span class="line">***********************************************************</span><br></pre></td></tr></table></figure>

<p>2、编译安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># make</span><br><span class="line"># make install</span><br></pre></td></tr></table></figure>

<h3 id="替代yum安装的zabbix-server"><a href="#替代yum安装的zabbix-server" class="headerlink" title="替代yum安装的zabbix_server"></a>替代yum安装的zabbix_server</h3><p>1、查看<code>/usr/sbin/zabbix_server</code>文件的情况，可以发现他是一个指向<code>/etc/alternatives/zabbix-server</code>的软连接，而<code>/etc/alternatives/zabbix-server</code>又是一个指向<code>/usr/sbin/zabbix_server_mysql</code>的软连接。</p>
<p>那么我们考虑用自己编译的zabbix_server替代yum安装的zabbix_server时，可以直接将<code>/usr/sbin/zabbix_server</code>的软连接指向<code>/home/zhang/ZbxServer/zabbix/sbin/zabbix_server</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[zhang@localhost zabbix-4.0.8]$ ll /usr/sbin/zabbix_server</span><br><span class="line">lrwxrwxrwx 1 root root 31 5月  31 10:41 /usr/sbin/zabbix_server -&gt; /etc/alternatives/zabbix-server</span><br><span class="line"></span><br><span class="line">[zhang@localhost zabbix-4.0.8]$ ll /etc/alternatives/zabbix-server</span><br><span class="line">lrwxrwxrwx 1 root root 29 5月  31 10:41 /etc/alternatives/zabbix-server -&gt; /usr/sbin/zabbix_server_mysql</span><br><span class="line"></span><br><span class="line">[zhang@localhost zabbix-4.0.8]$ ll /usr/sbin/zabbix_server_mysql</span><br><span class="line">-rwxr-xr-x 1 root root 2911888 5月  28 17:28 /usr/sbin/zabbix_server_mysql</span><br><span class="line"></span><br><span class="line"># zabbix_agentd不同，它不是一个软连接。</span><br><span class="line">[zhang@localhost zabbix-4.0.8]$ ll /usr/sbin/zabbix_agentd </span><br><span class="line">-rwxr-xr-x 1 root root 614848 5月  28 17:28 /usr/sbin/zabbix_agentd</span><br></pre></td></tr></table></figure>

<p>2、操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># make install之后，复制zabbix_server到/usr/sbin/目录下，并重命名为zabbix_server_mybuild</span><br><span class="line">[zhang@localhost ~]# cp -f /home/zhang/ZbxServer/zabbix/sbin/zabbix_server /usr/sbin/zabbix_server_mybuild</span><br><span class="line"># 更新软连接</span><br><span class="line">[zhang@localhost ~]# ln -snf /usr/sbin/zabbix_server_mybuild /etc/alternatives/zabbix-server</span><br><span class="line"># 还原为原来的</span><br><span class="line">[zhang@localhost ~]# ln -snf /usr/sbin/zabbix_server_mysql /etc/alternatives/zabbix-server</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/14/MyBlogs/Zabbix/01-zabbix环境准备、源码编译/" data-id="cjzb4nefa0001d4lgagdvj81d" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/08/14/MyBlogs/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/08/14/MyBlogs/Zabbix/01-zabbix环境准备、源码编译/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/08/14/MyBlogs/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>